{% extends 'layouts/app.html' %}
{% set title = 'HackerStash / Projects / ' + project.name + ' / Edit' %}

{% from "partials/avatar.html" import avatar, avatar_upload %}
{% from "partials/editor.html" import editor_light %}
{% from "partials/previews.html" import user_preview %}

{% set active_tab = request.args.get('tab') or 'details' %}

{% block body %}
    <div class="page edit-project">
        <header class="header">
            <h2 role="heading">Edit Project</h2>

            {% if g.user.member.owner %}
                {% if project.published %}
                    <a class="button secondary" href="{{ url_for('projects.unpublish', project_id=project.id) }}">Unpublish Project</a>
                {% else %}
                    <a class="button success" href="{{ url_for('projects.publish', project_id=project.id) }}">Publish Project</a>
                {% endif %}
            {% endif %}
        </header>

        <div class="tabs">
            <div class="tab-header">
                <a href="?tab=details" class="button {{ 'active' if active_tab == 'details' }}">Project details</a>
                <a href="?tab=team" class="button {{ 'active' if active_tab == 'team' }}">Team</a>
            </div>

            <div class="tab-body">
                <div class="tab {{ 'active' if active_tab == 'details' }}">
                    <form class="form editor-form pt-2" action="{{ url_for('projects.update', project_id=project.id) }}" method="post" enctype="multipart/form-data">
                        {% include "partials/messages.html" %}

                        <fieldset>
                            <h3>Summary</h3>

                            {% include "partials/project_edit.html" %}

                            <hr class="divider mb-2">

                            <div class="project-actions">
                                <section class="button-group">
                                    <button class="button" type="submit">Save changes</button>
                                    <a class="button secondary" href="{{ url_for('projects.show', project_id=project.id) }}">Cancel</a>
                                </section>

                                <a href="{{ url_for('projects.destroy', project_id=project.id) }}" class="button tertiary" type="button">Delete</a>
                            </div>
                        </fieldset>
                    </form>
                </div>

                <div class="tab {{ 'active' if active_tab == 'team' }}">
                    <label class="label mt-1 mb-1">Team members</label>
                    <p class="wrap-620 mb-2">If youâ€™re working on your project with other people, invite them to HackerStash as team members. They will each being able to participate in the community as members of your team.</p>
                    <ul class="team">
                        {% for m in project.members %}
                            <li>
                                {{ avatar(m.user, 'sm') }}
                                <p>{{ user_preview(m.user) }}</p>
                                {% if m.user.id == g.user.id %}
                                    <p class="edit"><a href="{{ url_for('projects.edit_member', project_id=project.id, member_id=m.id) }}">Edit role</a></p>
                                {% else %}
                                    <p class="edit"><a href="{{ url_for('projects.edit_member', project_id=project.id, member_id=m.id) }}">Manage</a></p>
                                {% endif %}
                            </li>
                        {% endfor %}

                        {% for i in project.invites %}
                            <li>
                                {{ avatar({}, 'sm') }}
                                <p>{{ i.first_name }}</p>
                                <p><i>Invite sent</i></p>
                                <p class="edit">
                                    <a href="{{ url_for('projects.remove_invite', project_id=i.project.id, invite_id=i.id) }}">Remove</a>
                                </p>
                            </li>
                        {% endfor %}

                        <li class="invite">
                            <a href="{{ url_for('projects.add_members', project_id=project.id) }}" class="button link">
                                <span class="invite-icon"><i class="icon ri-add-line"></i></span>
                                <span class="text">Add team member</span>
                            </a>
                        </li>
                    </ul>

                    <form class="form" action="{{ url_for('projects.update', project_id=project.id) }}" method="post">
                        <fieldset>
                            <label class="label mt-3">Time commitment</label>
                            <ul class="radio-group mt-1 mb-3">
                                <li>
                                    <span class="radio">
                                        <input class="input" type="radio" id="full-time" name="time_commitment" value="FULL_TIME" {{ 'checked' if project.time_commitment == 'FULL_TIME' }}>
                                        <span class="indicator"><span></span></span>
                                    </span>
                                    <label class="label" for="full-time">Full time</label>
                                </li>
                                <li>
                                    <span class="radio">
                                        <input class="input" type="radio" id="part-time" name="time_commitment" value="PART_TIME" {{ 'checked' if project.time_commitment == 'PART_TIME' }}>
                                        <span class="indicator"><span></span></span>
                                    </span>
                                    <label class="label" for="part-time">Side project</label>
                                </li>
                            </ul>

                            <div class="button-group">
                                <button class="button" type="submit">Save changes</button>
                                <a class="button secondary" href="{{ url_for('projects.show', project_id=project.id) }}">Cancel</a>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script type="text/javascript">
        window.onload = () => createEditor('.editor-form');
    </script>
{% endblock %}