{% extends 'base_app.html' %}
{% set title = 'HackerStash / Projects / ' + project.name %}

{% from "partials/avatar.html" import avatar %}
{% from "partials/posts.html" import posts %}
{% from "partials/prize.html" import expected_prize %}
{% from "partials/previews.html" import user_preview %}
{% from "partials/vote.html" import project_vote %}

{% block styles %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css" integrity="sha512-/zs32ZEJh+/EO2N1b0PEdoA10JkdC3zJ8L5FTiQu82LR9S/rOQNfQN7U59U9BC12swNeRAz3HSzIL2vpp4fv3w==" crossorigin="anonymous" />
{% endblock %}

{% block body %}
    <div class="page project">
        <header class="header">
            <div class="project-votes project-votes-{{ project.id }}">
                 {{ project_vote('lg', project) }}
            </div>
            <div class="details">
                <div class="project-details">
                    {{ avatar(project) }}
                    <h2>{{ project.name }}</h2>
                    <p class="d-none">@{{ project.name | lower }}</p>
                </div>
                <div class="mt-1 meta">
                    {% if project.start_month and project.start_year %}
                        <p><i class="icon ri-calendar-line"></i>Started {{ project.start_month | to_named_month }} {{ project.start_year }}</p>
                    {% endif %}
                    {% if project.location %}
                        <p><i class="icon ri-map-pin-2-fill"></i>{{ project.location }}</p>
                    {% endif %}
                    {% if project.url %}
                        <p>
                            <a target="blank" rel="nofollow noreferrer" href="{{ project.url if project.url.startswith('http') else '//' + project.url }}">
                                {{ project.url | to_nice_url }}
                            </a>
                        </p>
                    {% endif %}
                </div>
                <div class="mt-2 wrap-620">
                    <div class="rich_text">
                        {{ project.description | to_safe_html | safe }}
                    </div>
                </div>
            </div>
            <div class="button-group">
                {% if project.has_member(g.user) %}
                    <a aria-label="View Stash" href="{{ url_for('stash.index') }}" class="button success">ðŸ¦„ Stash ${{ project.stash or 0 }}</a>
                    <a aria-label="Edit project" href="{{ url_for('projects.edit', project_id=project.id) }}" class="button secondary">Edit</a>
                {% endif %}
            </div>
        </header>
        <section class="stats">
            <div class="graph">
                <h3>Project Score <span>{{ project.vote_score }}</span></h3>
                <div class="graph-container">
                    <canvas id="project-graph" width="520" height="200"></canvas>
                </div>
            </div>
            <div class="project-position">
                <h3>Current Position</h3>
                <div class="positioning mt-1-5">
                    <h1>{{ project.position }}<span>{{ project.position | to_ordinal_ending }}</span></h1>
                    {{ expected_prize(project) }}
                </div>
                <h3 class="mt-2">Votes received</h3>
                <div class="votes-received up">
                    <i class="icon ri-arrow-up-line"></i>
                    <h3>{{ project.upvotes }} <span>upvotes</span></h3>
                </div>
                <div class="votes-received down">
                    <i class="icon ri-arrow-down-line"></i>
                    <h3>{{ project.downvotes }} <span>downvotes</span></h3>
                </div>
            </div>
        </section>
        <section class="team-posts">
            <div class="team">
                <div class="title">
                    <h3>Team</h3>
                    {% if project.has_member(g.user) %}
                        <a class="button secondary" href="{{ url_for('projects.edit', project_id=project.id, tab='2') }}">Edit</a>
                    {% endif %}
                </div>
                <p class="mt-1-5">{% if project.members | length > 1 %}There are {{ project.members | length }} people{% else %}There is 1 person{% endif %} working on {{ project.name }} {{ 'full time' if project.time_commitment == 'FULL_TIME' else 'part time' }}.</p>
                <ul>
                    {% for member in project.members %}
                        <li>
                            {{ avatar(member.user, 'sm') }}
                            <p>
                                {{ user_preview(member.user) }}
                            </p>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            <div class="posts">
                <div class="title">
                    <h3>Posts</h3>
                    {% if project.has_member(g.user) %}
                        <a class="button" href="{{ url_for('posts.new') }}">Add new</a>
                    {% endif %}
                </div>
                <div class="list">
                    {{ posts(project.posts, limit=5) }}

                    {% if project.posts | length > 5 %}
                        <a href="{{ url_for('projects.all_posts', project_id=project.id) }}" class="load-more">Load more</a>
                    {% endif %}
                </div>
            </div>
        </section>
        <section class="lists">
            <div class="grid">
                <div>
                    <h4>Platforms &amp; devices</h4>
                    <ul>
                        {% for p in project.platforms_and_devices or [] %}
                            <li>
                                <i class="icon ri-check-line"></i>
                                {{ p | platforms_and_devices }}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <div>
                    <h4>Business model</h4>
                    <ul>
                        {% for b in project.business_models or [] %}
                            <li>
                                <i class="icon ri-check-line"></i>
                                {{ b | business_models }}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                <div>
                    <h4>Funding</h4>
                    <ul>
                        {% for f in project.fundings or [] %}
                            <li>
                                <i class="icon ri-check-line"></i>
                                {{ f | fundings }}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </section>
    </div>
{% endblock %}

{% block scripts %}
    <script type="text/javascript" src="//cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" integrity="sha512-s+xg36jbIujB2S2VKfpGmlC3T5V2TF3lY48DX7u2r9XzGzgPsa6wTpOQA7J9iffvdeBN0q9tKzRxVxw1JviZPg==" crossorigin="anonymous"></script>
    <script type="text/javascript">
        window.projectScoreData = "{{ project.project_score_data }}";
        window.onload = () => createEditor('#add-task-modal');
    </script>
{% endblock %}