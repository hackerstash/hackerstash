{% from "partials/avatar.html" import avatar %}
{% from "partials/previews.html" import project_preview %}

{% macro user_project_card(user) %}
    {% set is_self = user.id == (g.user and g.user.id) %}

    {% if is_self %}
        {% if user.project and not user.project.published %}
            <section class="project-card">
                <div class="row">
                     <aside>
                         <i>⏳</i>
                     </aside>
                    <div>
                        <h3>{{ user.project.name }} <p>UNPUBLISHED</p></h3>
                        <p>Publish your project to start participating in the HackerStash tournament.</p>
                        <div class="button-group">
                            <a aria-label="Open project publish modal" class="button success" href="{{ url_for('projects.publish', project_id=g.user.project.id) }}">
                                Publish Project
                            </a>
                            <a aria-label="View the edit project page" class="button secondary arrow" href="{{ url_for('projects.show', project_id=user.project.id) }}">
                                Edit project
                                <i class="ri-arrow-right-line"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </section>
        {% elif not user.project %}
            <section class="project-card">
                <div class="row">
                    <aside>
                        <i>✨</i>
                    </aside>
                    <div>
                        <h3>Add project</h3>
                        <p>To start participating in the HackerStash tournament, you’ll need to publish a project or be invited to join an <a href="{{ url_for('projects.index') }}">existing</a> one.</p>
                        <div class="button-group">
                            <a aria-label="Create a project" class="button" href="{{ url_for('projects.create') }}">Add project</a>
                            <a aria-label="View the tournament rules" class="button secondary" href="{{ url_for('rules.index') }}">Tournament rules</a>
                        </div>
                    </div>
                </div>
            </section>
        {% endif %}
    {% endif %}

    {% if user.project and user.project.published %}
        <section class="project-card">
            <div class="row">
                <aside>
                    {{ avatar(user.project, 'md') }}
                </aside>
                <div>
                    <h3>
                        {{ project_preview(user.project) }}
                    </h3>
                    <p class="rich-text">{{ user.project.description | to_safe_html | safe }}</p>
                    <div class="details">
                        <p><span>{{ user.project.members | length }}</span> Team members</p>
                        <p><i class="icon ri-focus-2-line"></i>Points: {{ user.project.vote_score }}</p>
                    </div>
                </div>
            </div>
        </section>
    {% endif %}
{% endmacro %}